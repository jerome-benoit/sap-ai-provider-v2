---
alwaysApply: true
---

# Project Structure Guide

This repository provides an SAP AI Provider compatible with the Vercel AI
SDK. Use these anchors to navigate the codebase quickly.

## Source Files

```text
src/
├── index.ts                                        # Public API exports
├── sap-ai-provider.ts                              # Main provider factory
├── sap-ai-provider-options.ts                      # Provider options & Zod schemas
├── sap-ai-language-model.ts                        # Language model (API-agnostic)
├── sap-ai-embedding-model.ts                       # Embedding model (API-agnostic)
├── sap-ai-settings.ts                              # Settings and type definitions
├── sap-ai-error.ts                                 # Error handling system
├── sap-ai-validation.ts                            # API resolution & validation
├── sap-ai-strategy.ts                              # Strategy factory (lazy loading)
├── strategy-utils.ts                               # Shared strategy utilities
├── orchestration-language-model-strategy.ts       # Orchestration API strategy
├── orchestration-embedding-model-strategy.ts      # Orchestration embedding strategy
├── foundation-models-language-model-strategy.ts   # Foundation Models API strategy
├── foundation-models-embedding-model-strategy.ts  # Foundation Models embedding strategy
├── convert-to-sap-messages.ts                     # Message format conversion
├── deep-merge.ts                                   # Deep merge utility
└── version.ts                                      # Package version constant
```

## Entry Points and Core Modules

- Main package entry: [src/index.ts](mdc:src/index.ts)
  - Re-exports provider factory and types.
- Provider factory: [src/sap-ai-provider.ts](mdc:src/sap-ai-provider.ts)
  - `createSAPAIProvider(options)` returns a provider function.
  - `sapai` default instance auto-detects service binding or AICORE_SERVICE_KEY.
- Provider options: [src/sap-ai-provider-options.ts](mdc:src/sap-ai-provider-options.ts)
  - Zod schemas for provider configuration validation.
- Language model: [src/sap-ai-language-model.ts](mdc:src/sap-ai-language-model.ts)
  - Implements `LanguageModelV3` contract (API-agnostic, delegates to strategies).
- Embedding model: [src/sap-ai-embedding-model.ts](mdc:src/sap-ai-embedding-model.ts)
  - Implements `EmbeddingModelV3` contract.
- Settings and types: [src/sap-ai-settings.ts](mdc:src/sap-ai-settings.ts)
  - Re-exports SAP AI SDK types.
- Error handling: [src/sap-ai-error.ts](mdc:src/sap-ai-error.ts)
- API validation: [src/sap-ai-validation.ts](mdc:src/sap-ai-validation.ts)
  - API resolution hierarchy and feature validation.
- Strategy factory: [src/sap-ai-strategy.ts](mdc:src/sap-ai-strategy.ts)
  - Lazy loading and caching of API strategies.
- Strategy utilities: [src/strategy-utils.ts](mdc:src/strategy-utils.ts)
  - Shared streaming and response building.
- Message conversion: [src/convert-to-sap-messages.ts](mdc:src/convert-to-sap-messages.ts)
- Deep merge utility: [src/deep-merge.ts](mdc:src/deep-merge.ts)
- Version constant: [src/version.ts](mdc:src/version.ts)

## API Strategy Files

- Orchestration language model:
  [src/orchestration-language-model-strategy.ts](mdc:src/orchestration-language-model-strategy.ts)
- Orchestration embedding model:
  [src/orchestration-embedding-model-strategy.ts](mdc:src/orchestration-embedding-model-strategy.ts)
- Foundation Models language model:
  [src/foundation-models-language-model-strategy.ts](mdc:src/foundation-models-language-model-strategy.ts)
- Foundation Models embedding model:
  [src/foundation-models-embedding-model-strategy.ts](mdc:src/foundation-models-embedding-model-strategy.ts)

## Build, Types, and Distribution

- TypeScript config: [tsconfig.json](mdc:tsconfig.json)
- Build config (CJS+ESM+DTS): [tsup.config.ts](mdc:tsup.config.ts)
- ESLint config: [eslint.config.mjs](mdc:eslint.config.mjs)
- Output: [dist/](mdc:dist/) produces `index.js`, `index.cjs`, `index.d.ts` with
  sourcemaps.
- `package.json` exports are aligned for Node and ESM:
  [package.json](mdc:package.json)

## Testing

- Node environment tests: [vitest.node.config.js](mdc:vitest.node.config.js)
- Edge runtime tests: [vitest.edge.config.js](mdc:vitest.edge.config.js)

## Examples and Docs

- README with usage and configuration: [README.md](mdc:README.md)
- Complete API reference: [API_REFERENCE.md](mdc:API_REFERENCE.md)
- Architecture documentation: [ARCHITECTURE.md](mdc:ARCHITECTURE.md)
- Contribution guidelines: [CONTRIBUTING.md](mdc:CONTRIBUTING.md)
- Environment setup guide: [ENVIRONMENT_SETUP.md](mdc:ENVIRONMENT_SETUP.md)
- Troubleshooting guide: [TROUBLESHOOTING.md](mdc:TROUBLESHOOTING.md)
- Migration guide: [MIGRATION_GUIDE.md](mdc:MIGRATION_GUIDE.md)
- cURL API testing guide:
  [CURL_API_TESTING_GUIDE.md](mdc:CURL_API_TESTING_GUIDE.md)
- AI agent instructions: [AGENTS.md](mdc:AGENTS.md)
- Examples: [examples/](mdc:examples/)
  - Chat completion:
    [examples/example-simple-chat-completion.ts](mdc:examples/example-simple-chat-completion.ts)
  - Tool calling:
    [examples/example-chat-completion-tool.ts](mdc:examples/example-chat-completion-tool.ts)
  - Image recognition:
    [examples/example-image-recognition.ts](mdc:examples/example-image-recognition.ts)
  - Text generation:
    [examples/example-generate-text.ts](mdc:examples/example-generate-text.ts)
  - Data masking:
    [examples/example-data-masking.ts](mdc:examples/example-data-masking.ts)
  - Streaming:
    [examples/example-streaming-chat.ts](mdc:examples/example-streaming-chat.ts)
  - Document grounding (RAG):
    [examples/example-document-grounding.ts](mdc:examples/example-document-grounding.ts)
  - Translation:
    [examples/example-translation.ts](mdc:examples/example-translation.ts)
  - Embeddings:
    [examples/example-embeddings.ts](mdc:examples/example-embeddings.ts)
  - Foundation Models API:
    [examples/example-foundation-models.ts](mdc:examples/example-foundation-models.ts)

## Runtime Requirements

- Node.js >= 18 (see `engines` in [package.json](mdc:package.json)).
- Authentication is handled automatically by SAP AI SDK:
  - On SAP BTP: Uses service binding (VCAP_SERVICES)
  - Locally: Uses AICORE_SERVICE_KEY environment variable
