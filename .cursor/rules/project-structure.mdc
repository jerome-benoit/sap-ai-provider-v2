---
alwaysApply: true
---

# Project Structure Guide

This repository provides an SAP AI Core provider compatible with the Vercel AI
SDK. Use these anchors to navigate the codebase quickly.

## Entry Points and Core Modules

- Main package entry: [src/index.ts](mdc:src/index.ts)
  - Re-exports provider factory and types.
- Provider factory and default instance:
  [src/sap-ai-provider.ts](mdc:src/sap-ai-provider.ts)
  - `createSAPAIProvider(options)` returns a provider function for model
    creation.
  - `sapai` default instance uses default configuration (auto-detects service
    binding or AICORE_SERVICE_KEY env var).
- Language model implementation:
  [src/sap-ai-language-model.ts](mdc:src/sap-ai-language-model.ts)
  - Implements Vercel AI SDK `LanguageModelV3` contract (v4.0.0+).
  - Supports text, tool calls, streaming, structured outputs (varies by model
    family).
- Embedding model implementation:
  [src/sap-ai-embedding-model.ts](mdc:src/sap-ai-embedding-model.ts)
  - Implements Vercel AI SDK `EmbeddingModelV3` contract.
  - Supports single and batch embedding generation.
- Message templating:
  [src/convert-to-sap-messages.ts](mdc:src/convert-to-sap-messages.ts)
- Settings and model IDs: [src/sap-ai-settings.ts](mdc:src/sap-ai-settings.ts)
  - Also re-exports all SAP AI SDK types for convenience.
- Error handling helpers: [src/sap-ai-error.ts](mdc:src/sap-ai-error.ts)

## Build, Types, and Distribution

- TypeScript config: [tsconfig.json](mdc:tsconfig.json)
- Build config (CJS+ESM+DTS): [tsup.config.ts](mdc:tsup.config.ts)
- ESLint config: [eslint.config.mjs](mdc:eslint.config.mjs)
- Output: [dist/](mdc:dist/) produces `index.js`, `index.cjs`, `index.d.ts` with
  sourcemaps.
- `package.json` exports are aligned for Node and ESM:
  [package.json](mdc:package.json)

## Testing

- Node environment tests: [vitest.node.config.js](mdc:vitest.node.config.js)
- Edge runtime tests: [vitest.edge.config.js](mdc:vitest.edge.config.js)

## Examples and Docs

- README with usage and configuration: [README.md](mdc:README.md)
- Complete API reference: [API_REFERENCE.md](mdc:API_REFERENCE.md)
- Architecture documentation: [ARCHITECTURE.md](mdc:ARCHITECTURE.md)
- Contribution guidelines: [CONTRIBUTING.md](mdc:CONTRIBUTING.md)
- Environment setup guide: [ENVIRONMENT_SETUP.md](mdc:ENVIRONMENT_SETUP.md)
- Troubleshooting guide: [TROUBLESHOOTING.md](mdc:TROUBLESHOOTING.md)
- Migration guide: [MIGRATION_GUIDE.md](mdc:MIGRATION_GUIDE.md)
- cURL API testing guide:
  [CURL_API_TESTING_GUIDE.md](mdc:CURL_API_TESTING_GUIDE.md)
- AI agent instructions: [AGENTS.md](mdc:AGENTS.md)
- Examples: [examples/](mdc:examples/)
  - Chat completion:
    [examples/example-simple-chat-completion.ts](mdc:examples/example-simple-chat-completion.ts)
  - Tool calling:
    [examples/example-chat-completion-tool.ts](mdc:examples/example-chat-completion-tool.ts)
  - Image recognition:
    [examples/example-image-recognition.ts](mdc:examples/example-image-recognition.ts)
  - Text generation:
    [examples/example-generate-text.ts](mdc:examples/example-generate-text.ts)
  - Data masking:
    [examples/example-data-masking.ts](mdc:examples/example-data-masking.ts)
  - Streaming:
    [examples/example-streaming-chat.ts](mdc:examples/example-streaming-chat.ts)
  - Document grounding (RAG):
    [examples/example-document-grounding.ts](mdc:examples/example-document-grounding.ts)
  - Translation:
    [examples/example-translation.ts](mdc:examples/example-translation.ts)
  - Embeddings:
    [examples/example-embeddings.ts](mdc:examples/example-embeddings.ts)
  - Foundation Models API:
    [examples/example-foundation-models.ts](mdc:examples/example-foundation-models.ts)

## Runtime Requirements

- Node.js >= 18 (see `engines` in [package.json](mdc:package.json)).
- Authentication is handled automatically by SAP AI SDK:
  - On SAP BTP: Uses service binding (VCAP_SERVICES)
  - Locally: Uses AICORE_SERVICE_KEY environment variable
